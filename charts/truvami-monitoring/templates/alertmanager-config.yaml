{{- if .Values.alertmanager.enabled }}
apiVersion: monitoring.coreos.com/v1alpha1
kind: AlertmanagerConfig
metadata:
  name: {{ include "truvami-monitoring.fullname" . }}-config
  namespace: {{ .Release.Namespace | quote }}
  labels:
    {{- include "truvami-monitoring.labels" . | nindent 4 }}
spec:
  route:
    groupBy: ['alertname']
    groupWait: 0s
    groupInterval: 5m
    repeatInterval: 5m
    receiver: 'watchdog-heartbeat'

  receivers:
  # Watchdog heartbeat receiver - sends to configured webhook URL
  - name: 'watchdog-heartbeat'
    {{- if .Values.watchdog.webhookUrl }}
    webhookConfigs:
    - url: {{ .Values.watchdog.webhookUrl | quote }}
      sendResolved: false
      httpConfig:
        followRedirects: true
      title: 'Truvami Monitoring Watchdog'
      text: 'Monitoring system is operational'
    {{- end }}

{{- end }}
