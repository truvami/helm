{{- if .Values.alertmanager.enabled }}
---
# Secret for OpsGenie API key
{{- if .Values.alertmanager.receivers.opsgenie.enabled }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "truvami-monitoring.fullname" . }}-opsgenie-secret
  namespace: {{ .Release.Namespace | quote }}
  labels:
    {{- include "truvami-monitoring.labels" . | nindent 4 }}
type: Opaque
data:
  api-key: {{ .Values.alertmanager.receivers.opsgenie.api_key | b64enc | quote }}
---
{{- end }}

# Secret for Slack webhook URL
{{- if .Values.alertmanager.receivers.slack.enabled }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "truvami-monitoring.fullname" . }}-slack-webhook
  namespace: {{ .Release.Namespace | quote }}
  labels:
    {{- include "truvami-monitoring.labels" . | nindent 4 }}
type: Opaque
data:
  webhook-url: {{ .Values.alertmanager.receivers.slack.webhook_url | b64enc | quote }}
---
{{- end }}

# Secret for PagerDuty routing key
{{- if .Values.alertmanager.receivers.pagerduty.enabled }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "truvami-monitoring.fullname" . }}-pagerduty-secret
  namespace: {{ .Release.Namespace | quote }}
  labels:
    {{- include "truvami-monitoring.labels" . | nindent 4 }}
type: Opaque
data:
  routing-key: {{ .Values.alertmanager.receivers.pagerduty.routing_key | b64enc | quote }}
---
{{- end }}

# Secret for Microsoft Teams webhook URL
{{- if .Values.alertmanager.receivers.teams.enabled }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "truvami-monitoring.fullname" . }}-teams-webhook
  namespace: {{ .Release.Namespace | quote }}
  labels:
    {{- include "truvami-monitoring.labels" . | nindent 4 }}
type: Opaque
data:
  webhook-url: {{ .Values.alertmanager.receivers.teams.webhook_url | b64enc | quote }}
---
{{- end }}

# Secret for Discord webhook URL
{{- if .Values.alertmanager.receivers.discord.enabled }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "truvami-monitoring.fullname" . }}-discord-webhook
  namespace: {{ .Release.Namespace | quote }}
  labels:
    {{- include "truvami-monitoring.labels" . | nindent 4 }}
type: Opaque
data:
  webhook-url: {{ .Values.alertmanager.receivers.discord.webhook_url | b64enc | quote }}
---
{{- end }}

# Combined secret for multiple AlertManager configurations
{{- if .Values.alertmanager.secrets }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "truvami-monitoring.fullname" . }}-alertmanager-secrets
  namespace: {{ .Release.Namespace | quote }}
  labels:
    {{- include "truvami-monitoring.labels" . | nindent 4 }}
type: Opaque
data:
  {{- if .Values.alertmanager.secrets.opsgenie_api_key }}
  opsgenie-api-key: {{ .Values.alertmanager.receivers.opsgenie.api_key | default "" | b64enc | quote }}
  {{- end }}
  {{- if .Values.alertmanager.secrets.slack_webhook_url }}
  slack-webhook-url: {{ .Values.alertmanager.receivers.slack.webhook_url | default "" | b64enc | quote }}
  {{- end }}
  {{- if .Values.alertmanager.secrets.smtp_auth_password }}
  smtp-password: {{ .Values.alertmanager.global.smtp_auth_password | default "" | b64enc | quote }}
  {{- end }}
{{- end }}

{{- end }}
